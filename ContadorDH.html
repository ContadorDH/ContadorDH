<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Asistencia Bochica Sur</title>
<style>
Â  :root{
Â  Â  --primary:#0066ff;
Â  Â  --primary-dark:#004ecc;
Â  Â  --bg:#f4f6fb;
Â  Â  --card:#ffffff;
Â  Â  --muted:#7b7b7b;
Â  Â  --radius:14px;
Â  }
Â  *{box-sizing:border-box}
Â  body{
Â  Â  margin:0;
Â  Â  font-family:Inter, Poppins, system-ui, -apple-system, "Segoe UI", Roboto, "Helvetica Neue", Arial;
Â  Â  background:var(--bg);
Â  Â  color:#222;
Â  Â  height:100vh;
Â  Â  overflow:hidden;
Â  }
Â  /* === Header moderno y centrado === */
header {
Â  position: relative;
Â  height: 64px;
Â  background: var(--primary);
Â  color: #fff;
Â  display: flex;
Â  align-items: center;
Â  justify-content: space-between;
Â  padding: 0 12px;
Â  font-weight: 600;
Â  box-shadow: 0 2px 10px rgba(0,0,0,0.1);
}

header button {
Â  background: none;
Â  border: 0;
Â  color: #fff;
Â  font-size: 20px;
Â  cursor: pointer;
}

header .title {
Â  position: absolute;
Â  left: 50%;
Â  transform: translateX(-50%);
Â  margin: 0;
Â  font-size: 1.1rem;
Â  font-weight: 600;
Â  letter-spacing: 0.3px;
Â  white-space: nowrap; /* âœ… Mantiene en una sola lÃ­nea */
Â  text-shadow: 0 0 6px rgba(255, 255, 255, 0.4);
Â  animation: fadeInTitle 0.6s ease-in-out;
}

/* âœ¨ AnimaciÃ³n elegante */
@keyframes fadeInTitle {
Â  from { opacity: 0; transform: translateX(-50%) translateY(-5px); }
Â  to { opacity: 1; transform: translateX(-50%) translateY(0); }
}



Â  #menuOverlay{
Â  Â  position:fixed; inset:0; background:rgba(0,0,0,0.32); display:none; z-index:80;
Â  }
Â  #menuOverlay.active{ display:block; }

Â  #menu{
Â  Â  position:fixed; top:0; left:-260px; width:260px; height:100%; background:var(--card);
Â  Â  box-shadow:4px 0 24px rgba(0,0,0,0.18); transition:left .28s ease; z-index:90;
Â  Â  padding-top:28px; display:flex; flex-direction:column;
Â  }
Â  #menu.active{ left:0; }
Â  #menu .item{
Â  Â  padding:14px 18px; border-bottom:1px solid #f0f0f0; background:transparent; text-align:left;
Â  Â  font-size:1rem; color:#222; border:0; cursor:pointer;
Â  }
Â  #menu .item:hover{ background:var(--primary); color:#fff }

Â  main{
Â  Â  height:calc(100vh - 64px); overflow:auto; padding:16px 12px;
Â  Â  display:flex; flex-direction:column; align-items:center; gap:12px;
Â  }

Â  .card{
Â  Â  width:92%; max-width:440px; background:var(--card);
Â  Â  border-radius:var(--radius); padding:12px 14px; box-shadow:0 8px 20px rgba(12,30,60,0.06);
Â  Â  display:flex; align-items:center; justify-content:space-between;
Â  }
Â  .label{ font-size:1rem; font-weight:600 }
Â  .controls{ display:flex; align-items:center; gap:8px }

Â  .counterBtn{
Â  Â  width:40px; height:40px; border-radius:10px; border:0; background:var(--primary); color:#fff;
Â  Â  font-size:20px; display:inline-flex; align-items:center; justify-content:center; cursor:pointer;
Â  }
Â  .counterBtn.ghost{ background:transparent; color:var(--muted); border:1px solid #eee; width:36px; height:36px; border-radius:8px; font-size:18px; }

Â  .value{
Â  Â  min-width:44px; text-align:center; font-weight:700; font-size:1.05rem;
Â  }

Â  .totalCard{
Â  Â  width:92%; max-width:440px; background:linear-gradient(90deg,#fff,#fff);
Â  Â  border-radius:var(--radius); padding:14px; text-align:center; font-weight:700; box-shadow:0 10px 28px rgba(2,20,80,0.04);
Â  Â  font-size:1.1rem;
Â  }

Â  #verPantalla{
Â  Â  position:fixed; inset:64px 0 0 0; background:var(--bg); z-index:70;
Â  Â  display:none; flex-direction:column; align-items:center; padding:12px 12px; overflow:auto;
Â  Â  transform:translateX(12px); opacity:0; transition:all .32s ease;
Â  }
Â  #verPantalla.active{ display:flex; transform:translateX(0); opacity:1 }

Â  #verHeader{
Â  Â  width:100%; max-width:820px; display:flex; gap:8px; align-items:center; justify-content:space-between;
Â  Â  background:var(--primary); color:#fff; border-radius:10px; padding:10px;
Â  }
Â  #verHeader .left{ display:flex; gap:10px; align-items:center }
Â  #verHeader select{ padding:8px 10px; border-radius:8px; border:0; font-weight:600 }
Â  #verHeader button{ background:transparent; border:0; color:#fff; font-size:18px; cursor:pointer; padding:6px 10px; border-radius:8px }

Â  #listado{
Â  Â  width:92%; max-width:820px; margin-top:12px; display:flex; flex-direction:column; gap:8px;
Â  }
Â  .row{
Â  Â  background:var(--card); padding:10px; border-radius:10px; box-shadow:0 6px 18px rgba(0,0,0,0.04);
Â  Â  font-size:0.95rem;
Â  }
Â  .row small{ color:var(--muted); display:block; margin-top:6px; font-size:0.85rem }

Â  #loginScreen{
Â  Â  position:fixed; inset:0; background:var(--bg); display:flex; align-items:center; justify-content:center;
Â  Â  flex-direction:column; z-index:120; gap:16px;
Â  }
Â  #loginBox{
Â  Â  background:var(--card); padding:28px; border-radius:var(--radius);
Â  Â  box-shadow:0 8px 24px rgba(0,0,0,0.08); text-align:center;
Â  }
Â  #loginBox input{
Â  Â  width:220px; padding:10px; border-radius:8px; border:1px solid #ddd; font-size:1rem;
Â  }
Â  #loginBox button{
Â  Â  margin-top:12px; background:var(--primary); color:#fff; border:0; padding:10px 16px; border-radius:8px; cursor:pointer;
Â  Â  font-weight:600;
Â  }

Â  .spinner{
Â  Â  width:36px; height:36px; border-radius:50%; border:4px solid #e6eefc; border-top-color:var(--primary);
Â  Â  animation:spin .9s linear infinite; margin-left:8px;
Â  }
Â  @keyframes spin{ to{ transform:rotate(360deg) } }

Â  /* Centrar los tÃ­tulos de los contadores */
Â  .card {
Â  Â  flex-direction: column;
Â  Â  gap: 8px;
Â  }
Â  .card .label {
Â  Â  text-align: center;
Â  Â  width: 100%;
Â  }


Â  @keyframes popupFade {
Â  from { transform:scale(0.9); opacity:0; }
Â  to { transform:scale(1); opacity:1; }
}
Â Â 
</style>
</head>
<body>

<div id="popupConfirm" style="
Â  position:fixed; inset:0;
Â  background:rgba(0,0,0,0.45);
Â  display:none; align-items:center; justify-content:center;
Â  z-index:210;">
Â  <div style="
Â  Â  background:#fff;
Â  Â  border-radius:16px;
Â  Â  padding:24px 28px;
Â  Â  text-align:center;
Â  Â  box-shadow:0 6px 26px rgba(0,0,0,0.15);
Â  Â  width:80%; max-width:300px;
Â  Â  animation:popupFade .3s ease;">
Â  Â  <h3 id="popupConfirmTitle" style="margin:0 0 10px;font-size:1.1rem;color:#222;">Confirmar</h3>
Â  Â  <p id="popupConfirmMsg" style="font-size:1rem;color:#444;margin:0 0 18px;"></p>
Â  Â  <div style="display:flex;gap:10px;justify-content:center;">
Â  Â  Â  <button id="popupConfirmNo" style="background:#ccc;color:#222;border:0;padding:8px 14px;border-radius:10px;font-weight:600;cursor:pointer;">Cancelar</button>
Â  Â  Â  <button id="popupConfirmYes" style="background:#0066ff;color:#fff;border:0;padding:8px 14px;border-radius:10px;font-weight:600;cursor:pointer;">Aceptar</button>
Â  Â  </div>
Â  </div>
</div>


Â Â 
Â  <div id="popupUsuario" style="
Â  position:fixed; inset:0;
Â  background:rgba(0,0,0,0.45);
Â  display:none; align-items:center; justify-content:center;
Â  z-index:200;">
Â  <div style="
Â  Â  background:#fff;
Â  Â  border-radius:16px;
Â  Â  padding:22px 28px;
Â  Â  text-align:center;
Â  Â  box-shadow:0 6px 26px rgba(0,0,0,0.15);
Â  Â  width:80%; max-width:300px;
Â  Â  animation:popupFade .3s ease;">
Â  Â  <h3 style="margin:0 0 8px;font-size:1.1rem;color:#222;">Usuario actual</h3>
Â  Â  <p id="popupNombre" style="font-weight:600;font-size:1.05rem;color:#444;margin:0;"></p>
Â  Â  <button onclick="cerrarPopupUsuario()" style="
Â  Â  Â  margin-top:16px;background:#0066ff;color:#fff;border:0;
Â  Â  Â  padding:10px 18px;border-radius:10px;font-weight:600;
Â  Â  Â  cursor:pointer;">Cerrar</button>
Â  </div>
</div>

<div id="loginScreen">
Â  <div id="loginBox">
Â  Â  <h2>Inicio de sesiÃ³n</h2>
Â  Â  <p>Ingresa tu nombre para registrar asistencias</p>
Â  Â  <input type="text" id="nombreUsuario" placeholder="Tu nombre completo">
Â  Â  <br>
Â  Â  <button onclick="iniciarSesion()">Entrar</button>
Â  </div>
</div>

<header>
Â  <button aria-label="menu" onclick="toggleMenu()">â˜°</button>

Â  <div class="title">ğŸ“‹ Asistencia Bochica Sur</div>

Â  <div id="userCircle" onclick="mostrarNombreUsuario()" title=""
Â  Â  style="width:36px;height:36px;border-radius:50%;
Â  Â  background:#ffffff33;color:#fff;display:flex;
Â  Â  align-items:center;justify-content:center;
Â  Â  font-weight:700;font-size:0.9rem;text-transform:uppercase;
Â  Â  border:2px solid #ffffff55;cursor:pointer;
Â  Â  transition:transform 0.2s ease, background 0.3s ease;">
Â  </div>
</header>


<div id="menuOverlay" onclick="closeMenuIfOpen(event)"></div>

<nav id="menu" aria-hidden="true">
Â  <button class="item" onclick="subirAsistencia()">ğŸ“¤ Subir asistencia</button>
Â  <button class="item" onclick="abrirVerPantalla()">ğŸ‘ï¸ Ver asistencia</button>
Â  <button class="item" onclick="eliminarAsistencia()">ğŸ—‘ï¸ Eliminar registros</button>
Â  <button class="item" onclick="cerrarSesion()">ğŸ”’ Cerrar sesiÃ³n</button>
Â  <div style="flex:1"></div>
Â  <button class="item" onclick="toggleMenu()">Cerrar</button>
</nav>

<main id="principal">
Â  <div class="card"><div class="label">Hermanos</div><div class="controls"><button class="counterBtn" onclick="changeCount('hermanos', -1)">âˆ’</button><div class="value" id="hermanos">0</div><button class="counterBtn" onclick="changeCount('hermanos', 1)">+</button></div></div>
Â  <div class="card"><div class="label">Hermanas</div><div class="controls"><button class="counterBtn" onclick="changeCount('hermanas', -1)">âˆ’</button><div class="value" id="hermanas">0</div><button class="counterBtn" onclick="changeCount('hermanas', 1)">+</button></div></div>
Â  <div class="card"><div class="label">Amigos</div><div class="controls"><button class="counterBtn" onclick="changeCount('amigos', -1)">âˆ’</button><div class="value" id="amigos">0</div><button class="counterBtn" onclick="changeCount('amigos', 1)">+</button></div></div>
Â  <div class="card"><div class="label">Adolescentes</div><div class="controls"><button class="counterBtn" onclick="changeCount('adolescentes', -1)">âˆ’</button><div class="value" id="adolescentes">0</div><button class="counterBtn" onclick="changeCount('adolescentes', 1)">+</button></div></div>
Â  <div class="card"><div class="label">NiÃ±os</div><div class="controls"><button class="counterBtn" onclick="changeCount('niÃ±os', -1)">âˆ’</button><div class="value" id="niÃ±os">0</div><button class="counterBtn" onclick="changeCount('niÃ±os', 1)">+</button></div></div>
Â  <div class="totalCard">Total asistencia: <span id="total">0</span></div>
</main>

<section id="verPantalla" aria-hidden="true">
Â  <div id="verHeader">
Â  Â  <div class="left"><button onclick="cerrarVerPantalla()">â†</button><div id="tituloMes" style="font-weight:700; font-size:1rem">Asistencia</div></div>
Â  Â  <div style="display:flex;align-items:center;gap:8px">
Â  Â  Â  <select id="selectMes" aria-label="Seleccionar mes" onchange="mesSeleccionado()"></select>
Â  Â  Â  <button title="Refrescar" onclick="refrescarMes()">âŸ³</button>
Â  Â  Â  <div id="loadingIndicator" style="display:none"><div class="spinner"></div></div>
Â  Â  </div>
Â  </div>
Â  <div id="listado"></div>
</section>

<script>
const URL_SCRIPT = "https://script.google.com/macros/s/AKfycbwuad6LbOg5k2TFzphjhPTm-NwMJwURzhfFPsEb8a5oB9KXuXIhWxe5QzrR2xLnDjYVlA/exec";
const datos = { hermanos:0, hermanas:0, amigos:0, adolescentes:0, niÃ±os:0 };
const meses = ["Enero","Febrero","Marzo","Abril","Mayo","Junio","Julio","Agosto","Septiembre","Octubre","Noviembre","Diciembre"];
let mesActual = meses[(new Date()).getMonth()];
let usuarioGlobal = localStorage.getItem("usuarioCelula") || "";

// === Ventanas modales reutilizables ===

// Mostrar popup de confirmaciÃ³n (reemplaza confirm())
function mostrarConfirmacion(titulo, mensaje, callback) {
Â  const popup = document.getElementById('popupConfirm');
Â  document.getElementById('popupConfirmTitle').innerText = titulo || 'Confirmar';
Â  document.getElementById('popupConfirmMsg').innerText = mensaje || '';
Â  popup.style.display = 'flex';

Â  // limpiar handlers previos
Â  const btnYes = document.getElementById('popupConfirmYes');
Â  const btnNo = document.getElementById('popupConfirmNo');
Â  btnYes.onclick = null;
Â  btnNo.onclick = null;

Â  btnYes.onclick = () => {
Â  Â  popup.style.display = 'none';
Â  Â  if (callback) callback(true);
Â  };
Â  btnNo.onclick = () => {
Â  Â  popup.style.display = 'none';
Â  Â  if (callback) callback(false);
Â  };
}

// Mostrar popup simple tipo â€œalertaâ€ (Ã©xito / error / advertencia)
function mostrarAlerta(titulo, mensaje, colorFondo = '#0066ff') {
Â  const temp = document.createElement('div');
Â  temp.style.position = 'fixed';
Â  temp.style.inset = '0';
Â  temp.style.display = 'flex';
Â  temp.style.alignItems = 'center';
Â  temp.style.justifyContent = 'center';
Â  temp.style.background = 'rgba(0,0,0,0.45)';
Â  temp.style.zIndex = '220';

Â  temp.innerHTML = `
Â  Â  <div style="
Â  Â  Â  background:#fff;
Â  Â  Â  border-radius:16px;
Â  Â  Â  padding:22px 26px;
Â  Â  Â  text-align:center;
Â  Â  Â  box-shadow:0 6px 26px rgba(0,0,0,0.15);
Â  Â  Â  width:80%; max-width:300px;
Â  Â  Â  animation:popupFade .3s ease;">
Â  Â  Â  <h3 style="margin:0 0 8px;font-size:1.1rem;color:#222;">${titulo}</h3>
Â  Â  Â  <p style="font-size:1rem;color:#444;margin:0 0 14px;">${mensaje}</p>
Â  Â  Â  <button style="
Â  Â  Â  Â  background:${colorFondo};
Â  Â  Â  Â  color:#fff;border:0;
Â  Â  Â  Â  padding:10px 18px;border-radius:10px;
Â  Â  Â  Â  font-weight:600;cursor:pointer;">Aceptar</button>
Â  Â  </div>`;
Â Â 
Â  temp.querySelector('button').onclick = () => document.body.removeChild(temp);
Â  document.body.appendChild(temp);
}


/* === LOGIN === */
function iniciarSesion(){
Â  const nombre = document.getElementById("nombreUsuario").value.trim();
Â  if(!nombre) return mostrarAlerta("âš ï¸ Falta el nombre", "Ingresa tu nombre para continuar.", "#ff9900"); // Reemplaza alert
Â  localStorage.setItem("usuarioCelula", nombre);
Â  usuarioGlobal = nombre;
Â  document.getElementById("loginScreen").style.display="none";
Â  actualizarUserCircle();

Â  // close menu if open
Â  const menu = document.getElementById('menu');
Â  const overlay = document.getElementById('menuOverlay');
Â  if(menu.classList.contains('active')) { menu.classList.remove('active'); overlay.classList.remove('active'); }
}

function cerrarSesion(){
Â  // Reemplaza confirm()
Â  mostrarConfirmacion("Cerrar sesiÃ³n", "Â¿EstÃ¡s seguro de que quieres cerrar tu sesiÃ³n?", (confirmado) => {
Â  Â  if(confirmado){
Â  Â  Â  localStorage.removeItem("usuarioCelula");
Â  Â  Â  usuarioGlobal="";
Â  Â  Â  document.getElementById("loginScreen").style.display="flex";
Â  Â  Â  // close menu if open
Â  Â  Â  const menu=document.getElementById('menu');
Â  Â  Â  const overlay=document.getElementById('menuOverlay');
Â  Â  Â  if(menu.classList.contains('active')) { menu.classList.remove('active'); overlay.classList.remove('active'); }
Â  Â  }
Â  });
}

if(usuarioGlobal){
Â  document.getElementById("loginScreen").style.display="none";
Â  actualizarUserCircle();
}

function actualizarUserCircle(){
Â  const circle = document.getElementById("userCircle");
Â  if(!circle) return;
Â  if(!usuarioGlobal){
Â  Â  circle.textContent = "";
Â  Â  circle.style.display = "none";
Â  Â  return;
Â  }
Â  const partes = usuarioGlobal.trim().split(" ");
Â  const iniciales = partes.length > 1
Â  Â  ? (partes[0][0] + partes[partes.length-1][0])
Â  Â  : partes[0][0];
Â  circle.textContent = iniciales.toUpperCase();
Â  circle.style.display = "flex";
}

// Se mantuvo la antigua funciÃ³n para evitar romper la lÃ³gica del click en el cÃ­rculo
function mostrarNombreUsuario(){
Â  if(!usuarioGlobal) return;
Â  document.getElementById("popupNombre").textContent = usuarioGlobal;
Â  document.getElementById("popupUsuario").style.display = "flex";
}

function cerrarPopupUsuario(){
Â  document.getElementById("popupUsuario").style.display = "none";
}

Â Â 

/* === MENÃš === */
function toggleMenu(){ const menu=document.getElementById('menu');const overlay=document.getElementById('menuOverlay');menu.classList.toggle('active');overlay.classList.toggle('active');menu.setAttribute('aria-hidden',!menu.classList.contains('active')); }
function closeMenuIfOpen(evt){ const menu=document.getElementById('menu'); if(menu.classList.contains('active')) toggleMenu(); }

/* === CONTADORES === */
function changeCount(tipo, delta){ datos[tipo]=Math.max(0,(datos[tipo]||0)+delta); document.getElementById(tipo).textContent=datos[tipo]; actualizarTotal(); }
function actualizarTotal(){ const total=Object.values(datos).reduce((a,b)=>a+b,0); document.getElementById('total').textContent=total; }

/* === POPUP ANTIGUO ELIMINADO === */
// La funciÃ³n mostrarPopupConfirm ya no es necesaria y fue eliminada.

Â Â 
/* === SUBIR ASISTENCIA MEJORADA === */
async function subirAsistencia(){
Â  if(!usuarioGlobal) return mostrarAlerta("âš ï¸ Error de sesiÃ³n", "Debes iniciar sesiÃ³n primero.", "#ff4444"); // Reemplaza alert
Â  const total = Object.values(datos).reduce((a,b)=>a+b,0);
Â  if(total === 0) return mostrarAlerta("Sin registros", "No hay personas registradas para subir.", "#ff9900"); // Reemplaza mostrarPopupConfirm

Â  // ğŸ”¹ cerrar menÃº si estÃ¡ abierto
Â  const menu = document.getElementById('menu');
Â  const overlay = document.getElementById('menuOverlay');
Â  if(menu.classList.contains('active')) { menu.classList.remove('active'); overlay.classList.remove('active'); }

Â  // ğŸ”¹ confirmar envÃ­o - Usando la nueva funciÃ³n
Â  mostrarConfirmacion("Confirmar envÃ­o", "Â¿Deseas subir esta asistencia?", async (confirmado) => {
Â  Â  if (!confirmado) return; // Si no confirma, no hace nada

Â  Â  const fecha = new Date().toLocaleString('es-CO', {
Â  Â  Â  day: '2-digit', month: '2-digit', year: 'numeric',
Â  Â  Â  hour: '2-digit', minute: '2-digit', second: '2-digit', hour12: true
Â  Â  });

Â  Â  const params = new URLSearchParams({
Â  Â  Â  usuario: usuarioGlobal,
Â  Â  Â  fecha,
Â  Â  Â  hermanos: datos.hermanos,
Â  Â  Â  hermanas: datos.hermanas,
Â  Â  Â  amigos: datos.amigos,
Â  Â  Â  adolescentes: datos.adolescentes,
Â  Â  Â  niÃ±os: datos.niÃ±os,
Â  Â  Â  total
Â  Â  });

Â  Â  try {
Â  Â  Â  const res = await fetch(`${URL_SCRIPT}?${params.toString()}`);
Â  Â  Â  const text = await res.text();

Â  Â  Â  if (text.includes('OK')) {
Â  Â  Â  Â  mostrarAlerta("âœ… Enviado", "Asistencia registrada correctamente.", "#00aa00");
Â  Â  Â  Â  // ğŸ”„ Reiniciar contadores
Â  Â  Â  Â  for (const k in datos) { datos[k] = 0; document.getElementById(k).textContent = 0; }
Â  Â  Â  Â  document.getElementById('total').textContent = 0;
Â  Â  Â  } else if (text.includes('DUPLICADO')) {
Â  Â  Â  Â  mostrarAlerta("âš ï¸ Duplicado", "Ya se enviÃ³ recientemente.", "#ff9900");
Â  Â  Â  } else {
Â  Â  Â  Â  mostrarAlerta("â„¹ï¸ Servidor", text, "#0066ff");
Â  Â  Â  }
Â  Â  } catch (e) {
Â  Â  Â  mostrarAlerta("âš ï¸ Error de conexiÃ³n", "No se pudo conectar con el servidor.", "#ff4444");
Â  Â  }
Â  });
}


/* === VER === */
function abrirVerPantalla(){ const menu=document.getElementById('menu');if(menu.classList.contains('active'))toggleMenu();const select=document.getElementById('selectMes');if(select.options.length===0){meses.forEach(m=>{const o=document.createElement('option');o.value=m;o.text=m;select.appendChild(o);});}select.value=mesActual;document.getElementById('tituloMes').textContent='Asistencia de: '+select.value;document.getElementById('verPantalla').classList.add('active');verAsistencia(select.value);}
function cerrarVerPantalla(){document.getElementById('verPantalla').classList.remove('active');}
function mesSeleccionado(){const select=document.getElementById('selectMes');mesActual=select.value;document.getElementById('tituloMes').textContent='Asistencia de: '+mesActual;verAsistencia(mesActual);}
function refrescarMes(){verAsistencia(document.getElementById('selectMes').value);}
function showLoading(s){document.getElementById('loadingIndicator').style.display=s?'block':'none';}

async function verAsistencia(mes){
Â  showLoading(true);
Â  const listado=document.getElementById('listado');listado.innerHTML='';
Â  try{
Â  Â  const res=await fetch(`${URL_SCRIPT}?accion=listar&mes=${encodeURIComponent(mes)}`);
Â  Â  const text=await res.text();let data;try{data=JSON.parse(text);}catch(e){data=[];}
Â  Â  if(!data||data.length<=1){listado.innerHTML=`<div class="row">âš ï¸ No hay registros en ${mes}.</div>`;showLoading(false);return;}
Â  Â  const filas=data.slice(1).reverse();
Â  Â  listado.innerHTML=filas.map(r=>{
Â  Â  Â  const [usuario,fecha,h,hm,am,ad,ni,tot]=r;
Â  Â  Â  const esPropio = usuarioGlobal && usuarioGlobal.toLowerCase()===String(usuario).toLowerCase();
Â  Â  Â  // Use encodeURIComponent to safely pass parameters to eliminarRegistro via onclick
Â  Â  Â  const usuarioEsc = escapeHTML(String(usuario || ''));
Â  Â  Â  const fechaEsc = escapeHTML(String(fecha || ''));
Â  Â  Â  const usuarioEnc = encodeURIComponent(String(usuario || ''));
Â  Â  Â  const fechaEnc = encodeURIComponent(String(fecha || ''));
Â  Â  Â  return `<div class="row">
Â  Â  Â  Â  <strong>ğŸ‘¤ ${usuarioEsc}</strong>
Â  Â  Â  Â  <small>ğŸ“… ${fechaEsc}</small>
Â  Â  Â  Â  <div style="margin-top:8px">ğŸ™‹â€â™‚ï¸ ${h} ğŸ™‹â€â™€ï¸ ${hm} ğŸ¤ ${am} ğŸ‘§ ${ad} ğŸ§’ ${ni}</div>
Â  Â  Â  Â  <small>ğŸ”¢ Total: <strong>${escapeHTML(tot)}</strong></small>
Â  Â  Â  Â  ${esPropio?`<button style="margin-top:8px;background:#ff4444;color:#fff;border:0;padding:6px 10px;border-radius:8px;cursor:pointer" onclick="eliminarRegistro('${usuarioEnc}','${fechaEnc}')">ğŸ—‘ï¸ Eliminar</button>`:''}
Â  Â  Â  </div>`;
Â  Â  }).join('');
Â  }catch(e){listado.innerHTML=`<div class="row">âš ï¸ Error obteniendo datos.</div>`;}finally{showLoading(false);}
}

/* === ELIMINAR === */
async function eliminarAsistencia(){
Â  if(!usuarioGlobal) return mostrarAlerta("âš ï¸ Error de sesiÃ³n", "Debes iniciar sesiÃ³n.", "#ff4444"); // Reemplaza alert
Â  
Â  // Reemplaza confirm()
Â  mostrarConfirmacion("Eliminar registros", "Â¿Eliminar asistencias enviadas por ti en los Ãºltimos 10 minutos?", async (confirmado) => {
Â  Â  if (!confirmado) return;

Â  Â  try{
Â  Â  Â  const res=await fetch(`${URL_SCRIPT}?accion=eliminar&usuario=${encodeURIComponent(usuarioGlobal)}`);
Â  Â  Â  const text=await res.text();
Â  Â  Â  if(text.startsWith("ELIMINADAS_")){
Â  Â  Â  Â  const n=text.split('_')[1]||'';
Â  Â  Â  Â  mostrarAlerta("ğŸ—‘ï¸ Eliminadas", "Se eliminaron "+n+" fila(s).", "#00aa00"); // Reemplaza alert
Â  Â  Â  }
Â  Â  Â  else mostrarAlerta("â„¹ï¸ Servidor", text, "#0066ff"); // Reemplaza alert
Â  Â  }catch(e){
Â  Â  Â  mostrarAlerta("âš ï¸ Error al eliminar", "No se pudo completar la acciÃ³n.", "#ff4444"); // Reemplaza alert
Â  Â  }
Â  });
}

async function eliminarRegistro(usuarioEnc,fechaEnc){
Â  const usuario = decodeURIComponent(usuarioEnc);
Â  const fecha = decodeURIComponent(fechaEnc);
Â  
Â  // Reemplaza confirm()
Â  mostrarConfirmacion("Eliminar registro", `Â¿Eliminar el registro de ${usuario} en ${fecha}?`, async (confirmado) => {
Â  Â  if (!confirmado) return;

Â  Â  try{
Â  Â  Â  const res=await fetch(`${URL_SCRIPT}?accion=eliminar&usuario=${encodeURIComponent(usuario)}&fecha=${encodeURIComponent(fecha)}`);
Â  Â  Â  const text=await res.text();
Â  Â  Â  if(text.includes("ELIMINADA") || text.startsWith("ELIMINADAS_") ){ 
Â  Â  Â  Â  mostrarAlerta("ğŸ—‘ï¸ Eliminado", "Registro eliminado.", "#00aa00"); // Reemplaza alert
Â  Â  Â  Â  refrescarMes(); 
Â  Â  Â  }
Â  Â  Â  else mostrarAlerta("âš ï¸ Error", text, "#ff4444"); // Reemplaza alert
Â  Â  }catch(e){
Â  Â  Â  mostrarAlerta("âš ï¸ Error al eliminar", "No se pudo conectar con el servidor.", "#ff4444"); // Reemplaza alert
Â  Â  }
Â  });
}

/* === HELPERS === */
function escapeHTML(s){return (s+'').replace(/[&<>"']/g,c=>({'&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;',"'":'&#39;'}[c]));}
(function init(){actualizarTotal();const select=document.getElementById('selectMes');meses.forEach(m=>{const o=document.createElement('option');o.value=m;o.text=m;select.appendChild(o);});select.value=mesActual; /* show login if needed */ if(usuarioGlobal){ document.getElementById("loginScreen").style.display="none"; } else { document.getElementById("loginScreen").style.display="flex"; } })();
</script>
</body>
</html>
